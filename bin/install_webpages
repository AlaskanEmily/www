#!/bin/sh
#
# install_webpages
#
# Responsible for updating the hypermail archive, updating the
# search database and installing the web pages.
#
# Note this script must be run on a machine with php3, hypermail and htdig
# installed, ie hydra, have the INSTALL_WEBDIR environment variable set
# and be run from the top level directory of the w3 module.
#

export PATH=/usr/local/bin:$PATH

whathost=`hostname | sed -e 's/\..*//'`
if [ $whathost != "hydra" ]
then
    echo "install_webpages: must be run on hydra."
    exit 1
fi

DIR=${INSTALL_WEBDIR=spec_unknown_value}
if [ $DIR == "spec_unknown_value" ]
then
    echo "install_webpages: INSTALL_WEBDIR not set."
    exit 1
fi

if [ ! -e "news.php3" ]
then
    echo "install_webpages: must be run from the top level of w3 module."
    exit 1
fi

set -x

    #
    # Rearchive the mailing list.
    #
(
    cd mailing-lists;
    ./rearchive
)

    #
    # Install the web pages
    #
cvs update .
cvs checkout tutorial
make install

    #
    # Reindex the web site for searching.
    #
umask 002

    # Index the web-site for searching.
htdig -c /etc/htdig/htdig-mercury.conf -a
htmerge -c /etc/htdig/htdig-mercury.conf -a

    # Replace the work files with their alternate versions.
cd /home/mercury5/htdig
for file in `ls *.work`
do
    mv $file `basename $file .work`
done
